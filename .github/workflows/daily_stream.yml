name: Daily Stream Check

on:
  schedule:
    # 8:00 AM IST = 02:30 UTC
    - cron: '30 2 * * *'
  workflow_dispatch:
    inputs:
      platform:
        description: 'Target Platform'
        required: true
        default: 'facebook'
        type: choice
        options:
        - facebook
        - instagram

jobs:
  check-and-stream:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Create Config and Run Auto Streamer
      env:
        YOUTUBE_CHANNEL: ${{ secrets.YOUTUBE_CHANNEL_URL }}
        FB_STREAM_KEY: ${{ secrets.FB_STREAM_KEY }}
      run: |
        # Create config.json from secrets
        echo "{ \"youtube_channel_url\": \"$YOUTUBE_CHANNEL\", \"facebook_stream_key\": \"$FB_STREAM_KEY\" }" > config.json
        
        python autostream.py

